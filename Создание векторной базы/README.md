# Модуль создания векторной базы данных

Этот модуль предназначен для создания векторной базы данных из JSON файлов с информацией о косметических продуктах.

## Описание

Модуль `vector_db_builder` обрабатывает JSON файлы с данными о продуктах и статьях, создает эмбеддинги и сохраняет их в векторную базу данных ChromaDB для последующего использования в RAG-системе.

## Структура модуля

```
vector_db_builder/
├── build_rag.py          # Основной скрипт создания векторной базы
├── config.py             # Конфигурация модуля
├── requirements.txt      # Зависимости Python
├── README.md             # Эта документация
└── JSON файлы/           # Исходные данные в формате JSON
    ├── 01 Skinessentials_часть1.json
    ├── 01 Skinessentials_часть2.json
    └── ...
```

## Установка

### 1. Установка зависимостей

```bash
cd vector_db_builder
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` в корне проекта (на уровень выше модуля) или в папке модуля:

```env
# Chroma DB
CHROMA_DB_PATH=../chroma_db

# Embedding Model
EMBEDDING_MODEL=paraphrase-multilingual-MiniLM-L12-v2
```

**Доступные модели эмбеддингов:**
- `paraphrase-multilingual-MiniLM-L12-v2` (по умолчанию, легкая)
- `intfloat/multilingual-e5-base` (средняя)
- `intfloat/multilingual-e5-large` (тяжелая, но более точная)

## Использование

### Запуск создания векторной базы

```bash
cd vector_db_builder
python build_rag.py
```

### Процесс работы

1. **Загрузка JSON файлов** - скрипт загружает все JSON файлы из папки `JSON файлы/`
2. **Обработка данных** - извлекает продукты и статьи из JSON файлов
3. **Создание preview** - создает файл `chunks_preview.txt` с примерами обработанных данных
4. **Подтверждение** - после просмотра preview нажмите Enter для продолжения
5. **Генерация эмбеддингов** - создает векторные представления текстов
6. **Сохранение в ChromaDB** - загружает данные в векторную базу данных

### Структура JSON файлов

JSON файлы должны содержать следующие структуры:

**Для продуктов:**
```json
{
  "products": [
    {
      "name_ru": "Название на русском",
      "name_en": "English name",
      "brand": "Бренд",
      "line": "Линия",
      "description_full": "Полное описание продукта",
      "skin_type": "Тип кожи",
      "skus": [...]
    }
  ]
}
```

**Для статей:**
```json
{
  "knowledge": [
    {
      "title": "Заголовок статьи",
      "content": "Содержание статьи"
    }
  ]
}
```

## Результат

После выполнения скрипта будет создана векторная база данных в папке `../chroma_db/` (на уровень выше модуля), которая может использоваться модулем `ai_assistant_bot`.

## Особенности

- Автоматическая обработка дубликатов продуктов
- Нормализация ID для уникальности
- Батч-обработка для эффективной генерации эмбеддингов
- Preview файл для проверки данных перед загрузкой
- Поддержка больших объемов данных

## Устранение проблем

### Ошибка: "Не найдено JSON файлов"
- Убедитесь, что папка `JSON файлы/` существует и содержит JSON файлы
- Проверьте правильность путей в скрипте

### Ошибка при загрузке модели
- Убедитесь, что установлены все зависимости: `pip install -r requirements.txt`
- Проверьте доступность интернета для загрузки модели
- Попробуйте использовать более легкую модель

### Ошибка при сохранении в ChromaDB
- Проверьте права доступа к папке `chroma_db`
- Убедитесь, что достаточно места на диске

## Зависимости

- `chromadb>=1.4.1` - векторная база данных
- `sentence-transformers==2.3.1` - модели эмбеддингов
- `python-dotenv==1.0.0` - загрузка переменных окружения
- `tqdm>=4.65.0` - прогресс-бар
