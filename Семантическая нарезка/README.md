# Семантическая нарезка косметических каталогов

Проект для преобразования текстовых каталогов косметики в структурированный JSON формат, предназначенный для использования в системах RAG (Retrieval-Augmented Generation).

## Описание

Система автоматически извлекает информацию о продуктах и знаниях из неструктурированных текстовых каталогов косметики, преобразуя их в JSON с четкой структурой. Использует GPT-4o mini через ProxyAPI для семантического анализа и извлечения данных.

## Структура проекта

```
.
├── process_catalog.py          # Основной модуль с функциями извлечения
├── process_large_file.py        # Обработка больших файлов по частям
├── process_part.py              # Обработка отдельных частей файлов
├── requirements.txt             # Зависимости Python
├── Keys.txt                     # API ключ (не коммитится в git)
├── README.md                    # Этот файл
│
├── final_clean/                 # Исходные текстовые каталоги
│   ├── 01 Skinessentials БАЗОВЫЙ УХОД текст.txt
│   ├── 02 SKINDICATION КОРРЕКЦИЯ ОСОБЫХ СОСТОЯНИЙ.txt
│   ├── 03 Skintelligence АНТИ-ЭЙДЖ.txt
│   ├── Seboradin.txt
│   └── КАТАЛОГ DR.SPILLER.txt
│
├── Разделенные файлы/           # Файлы, разделенные на части для обработки
│   ├── 01 Skinessentials_часть1.txt
│   ├── 01 Skinessentials_часть2.txt
│   ├── 02 SKINDICATION_часть1.txt
│   ├── 02 SKINDICATION_часть2.txt
│   ├── 03 Skintelligence_часть1.txt
│   ├── 03 Skintelligence_часть2.txt
│   ├── Seboradin_часть1.txt
│   ├── Seboradin_часть2.txt
│   ├── Seboradin_часть3.txt
│   ├── КАТАЛОГ DR.SPILLER_часть1.txt
│   ├── КАТАЛОГ DR.SPILLER_часть2.txt
│   └── КАТАЛОГ DR.SPILLER_часть3.txt
│
└── output_new_json/             # Результирующие JSON файлы
    ├── 01 Skinessentials_часть1.json
    ├── 01 Skinessentials_часть2.json
    ├── 01 Skinessentials_часть3.json
    ├── 02 SKINDICATION_часть1.json
    ├── 02 SKINDICATION_часть2.json
    ├── 03 Skintelligence_часть1.json
    ├── 03 Skintelligence_часть2.json
    ├── Seboradin_часть1.json
    ├── Seboradin_часть2.json
    ├── Seboradin_часть3.json
    ├── КАТАЛОГ DR.SPILLER_часть1.json
    ├── КАТАЛОГ DR.SPILLER_часть2.json
    └── КАТАЛОГ DR.SPILLER_часть3.json
```

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Настройте API ключ:
   - Создайте файл `Keys.txt` в корне проекта
   - Добавьте ваш API ключ OpenAI (или ProxyAPI) в формате:
     ```
     sk-your-api-key-here
     ```
     или
     ```
     API_KEY=sk-your-api-key-here
     ```

## Использование

### Обработка одного файла (небольшого размера)

```bash
python process_part.py "Разделенные файлы\01 Skinessentials_часть1.txt"
```

### Обработка большого файла (с автоматическим разбиением на части)

```bash
python process_large_file.py "Разделенные файлы\КАТАЛОГ DR.SPILLER_часть1.txt"
```

### Обработка файла из папки final_clean

```bash
python process_catalog.py 1
# или
python process_catalog.py Skinessentials
```

## Формат выходных данных

Результирующий JSON имеет следующую структуру:

```json
{
  "products": [
    {
      "id": "000001",
      "brand": "Reviderm",
      "name_ru": "Очищающее молочко",
      "name_en": "cleansing milk",
      "line": "Skinessentials",
      "category": "СРЕДСТВА ДЛЯ ОЧИЩЕНИЯ",
      "type": "молочко",
      "skin_type": "Для нормальной и сухой кожи",
      "usage": "Полная инструкция по применению...",
      "description_full": "Полное описание продукта с механизмом действия, активными ингредиентами и эффектами...",
      "skus": [
        {
          "art": "80009",
          "vol": "200 мл",
          "type": "home"
        },
        {
          "art": "80227",
          "vol": "500 мл",
          "type": "pro"
        }
      ]
    }
  ],
  "knowledge": [
    {
      "type": "knowledge",
      "category": "Типы кожи",
      "title": "Уход за проблемной кожей",
      "content": "Полный текст знания...",
      "recommendations": ["Рекомендация 1", "Рекомендация 2"]
    }
  ]
}
```

### Поля продуктов (products)

- **id**: Уникальный последовательный идентификатор (формат: `000001`, `000002`, ...)
- **brand**: Название бренда (Reviderm, Seboradin, Dr. Spiller)
- **name_ru**: Русское название продукта
- **name_en**: Английское название продукта (если указано в тексте)
- **line**: Название линии (например, "Skinessentials", "SKINDICATION")
- **category**: Категория продукта (точно копируется из заголовка раздела)
- **type**: Тип средства (крем, тоник, сыворотка, молочко, гель и т.д.)
- **skin_type**: Тип кожи / показания
- **usage**: Полная инструкция по применению
- **description_full**: Полное описание с механизмом действия, активными ингредиентами и эффектами
- **skus**: Массив вариантов продукта с артикулами, объемами и типами (home/pro)

### Поля знаний (knowledge)

- **type**: Всегда "knowledge"
- **category**: Категория знания (например, "Философия бренда", "Технологии", "Протоколы ухода")
- **title**: Заголовок знания
- **content**: Полный текст знания
- **recommendations**: Массив рекомендаций (если есть)

## Поддерживаемые бренды

Система автоматически определяет бренд по имени файла:

- **Reviderm**: файлы с `skindication`, `skinessentials`, `skintelligence`, `skinprofessional`
- **Seboradin**: файлы с `seboradin`
- **Dr. Spiller**: файлы с `spiller`, `dr.spiller`, `dr`

## Особенности обработки

1. **Автоматическое разбиение больших файлов**: Файлы размером более 20,000 символов автоматически разбиваются на части для избежания таймаутов API.

2. **Последовательные ID**: Каждый продукт получает уникальный последовательный ID в формате `000001`, `000002`, и т.д.

3. **Извлечение артикулов**: Артикулы, указанные после описания продукта, автоматически связываются с предыдущим продуктом.

4. **Полное сохранение текста**: Все описания, инструкции и знания сохраняются полностью без сокращений (удаляются только маркетинговые слоганы в CAPS LOCK).

5. **Обработка знаний**: Информация о философии бренда, технологиях, протоколах ухода и других общих знаниях извлекается отдельно в раздел `knowledge`.

## Технические детали

- **API**: OpenAI GPT-4o mini через ProxyAPI
- **Таймаут**: 900 секунд (15 минут) для больших файлов
- **Кодировка**: UTF-8
- **Формат JSON**: С отступами (indent=2), без ASCII-экранирования

## Обработка ошибок

- Автоматические повторы при таймаутах API
- Обработка ошибок чтения файлов
- Валидация JSON перед сохранением
- Логирование процесса обработки

## Примеры использования

### Обработка всех частей файла Skinessentials

```bash
python process_part.py "Разделенные файлы\01 Skinessentials_часть1.txt"
python process_part.py "Разделенные файлы\01 Skinessentials_часть2.txt"
python process_part.py "Разделенные файлы\01 Skinessentials_часть3.txt"
```

### Обработка большого файла Dr. Spiller

```bash
python process_large_file.py "Разделенные файлы\КАТАЛОГ DR.SPILLER_часть1.txt"
```

## Примечания

- Убедитесь, что файл `Keys.txt` содержит валидный API ключ
- Большие файлы обрабатываются дольше из-за разбиения на части
- Результирующие JSON файлы сохраняются в папку `output_new_json/`
- При обработке больших файлов результаты объединяются автоматически

## Лицензия

Проект для внутреннего использования.
